#!/usr/bin/env bpp

# Copyright (C) 2025 Andrew S. Rightenburg
# GNU General Public License v3.0 or later (GPL-3.0-or-later)
# This file is part of the Bash++ Standard Library.

## Simple Array implementation
@class Array {
	## @ignore
	@protected array=()

	## Get the number of elements in the array.
	## @outputs The number of elements in the array.
	@virtual @public @method size {
		echo "@{#this.array[@]}"
	}

	## Add a value to the end of the array.
	## @param value The value to add to the array.
	@virtual @public @method push value {
		@this.array+=("$value")
	}

	## Remove and echo the last element of the array.
	## @outputs The last element of the array.
	## @returns 1 if the array is empty, 0 otherwise.
	@virtual @public @method pop {
		if [[ @{#this.array[@]} -gt 0 ]]; then
			echo "@{this.array[-1]}"
			unset &@this.array[-1]
		else
			return 1
		fi
	}

	## Insert a value at a specific index in the array.
	## @param index The index at which to insert the value.
	## @param value The value to insert into the array.
	## @returns 1 if the index is out of bounds, 0 otherwise.
	@virtual @public @method insert index value {
		if [[ $index -lt 0 || $index -gt @{#this.array[@]} ]]; then
			return 1
		fi
		# TODO:
		# This is a hack because Bash++ references do not yet have 100% support for parameter expansion
		# Therefore we need to copy the array to a primitive first before doing the
		# Parameter expansion with Bash alone
		# This should be removed once we have full support for parameter expansion on Bash++ [@] references
		local array_copy=("@{this.array[@]}")
		@this.array=("${array_copy[@]:0:$index}" "$value" "${array_copy[@]:$index}")
	}

	## Remove the specified index from the array.
	## @param index The index of the value to remove.
	## @returns 1 if the index is out of bounds, 0 otherwise.
	@virtual @public @method remove index {
		if [[ $index -lt 0 || $index -ge @{#this.array[@]} ]]; then
			return 1
		fi
		local array_copy=("@{this.array[@]}")
		@this.array=("${array_copy[@]:0:$index}" "${array_copy[@]:$((index + 1))}")
	}

	## Get the value at a specific index.
	## @param index The index of the value to retrieve.
	## @outputs The value at the specified index.
	@virtual @public @method at index {
		echo "@{this.array[$index]}"
	}

	## Echo the first element of the array.
	## @outputs The first element of the array.
	## @returns 1 if the array is empty, 0 otherwise.
	@virtual @public @method front {
		if [[ @{#this.array[@]} -gt 0 ]]; then
			echo "@{this.array[0]}"
		else
			return 1
		fi
	}

	## Echo the last element of the array.
	## @outputs The last element of the array.
	## @returns 1 if the array is empty, 0 otherwise.
	@virtual @public @method back {
		if [[ @{#this.array[@]} -gt 0 ]]; then
			echo "@{this.array[-1]}"
		else
			return 1
		fi
	}

	## Echo all elements of the array.
	## @outputs All elements of the array separated by spaces.
	## @returns 1 if the array is empty, 0 otherwise.
	@virtual @public @method all {
		if [[ @{#this.array[@]} -gt 0 ]]; then
			echo "@{this.array[@]}"
		else
			return 1
		fi
	}

	## Silently returns whether the array is empty.
	## @outputs nothing
	## @returns 0 if the array is empty, 1 otherwise.
	@virtual @public @method empty {
		if [[ @{#this.array[@]} -eq 0 ]]; then
			return 0
		else
			return 1
		fi
	}

	## Echo a slice of the array from start to end indices.
	## @param start The starting index of the slice (inclusive).
	## @param end The ending index of the slice (inclusive).
	## @outputs The elements in the specified slice separated by spaces.
	## @returns 1 if the start index is greater than the end index or if the array is empty, 0 otherwise.
	@virtual @public @method slice start end {
		if [[ $start -gt $end || @{#this.array[@]} -eq 0 ]]; then
			return 1
		fi
		if [[ $start -lt 0 ]]; then
			start=0
		fi
		if [[ $end -ge @{#this.array[@]} ]]; then
			end=$(( @{#this.array[@]} - 1 ))
		fi
		local array_copy=("@{this.array[@]}")
		echo "${array_copy[@]:$start:$((end - start + 1))}"
	}

	## Clear the array by removing all elements.
	@virtual @public @method clear {
		unset &@this.array
	}
}
